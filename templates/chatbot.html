{% extends "base_new.html" %} {% block title %}AI Psychology Support - UniCare{%
endblock %} {% block content %}
<section class="py-16 bg-gradient-to-br from-purple-50 to-pink-50">
  <div class="max-w-6xl mx-auto px-4">
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-gray-800 mb-4">
        AI Psychology Support
      </h1>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto">
        Talk to our AI assistant trained in psychology principles. Get immediate
        support, coping strategies, and guidance 24/7.
      </p>
      <div
        class="mt-4 p-4 bg-blue-100 rounded-lg border-l-4 border-blue-500 max-w-2xl mx-auto"
      >
        <p class="text-sm text-blue-800">
          <i class="bi bi-info-circle mr-2"></i>
          This AI assistant provides general support and is not a replacement
          for professional therapy. In crisis situations, please contact
          emergency services or a mental health professional.
        </p>
      </div>
    </div>


      <!-- Chat Interface -->
      <div>
        <div class="bg-white rounded-xl shadow-lg h-[600px] flex flex-col mb-8">
          <!-- Chat Header -->
          <div class="p-6 border-b border-gray-200 flex items-center">
            <div
              class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center mr-4"
            >
              <i class="bi bi-robot text-white text-xl"></i>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800">
                Dr. AI Assistant
              </h3>
              <p class="text-sm text-gray-600">
                Psychology Support • Always Available
              </p>
            </div>
            <div class="ml-auto flex items-center">
              <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
              <span class="text-sm text-gray-600">Online</span>
            </div>
          </div>

          <!-- Current Mood Banner -->
          <div id="current-mood-banner" class="flex items-center gap-4 bg-blue-50 border-l-4 border-blue-400 rounded-lg px-5 py-3 my-2 max-w-lg mx-auto shadow-sm" style="display:none;">
            <span id="current-mood-emoji" class="text-2xl"></span>
            <span class="font-medium text-gray-800">Current Mood:</span>
            <span id="current-mood-text" class="capitalize font-semibold"></span>
            <span class="text-gray-500">| Anxiety:</span>
            <span id="current-anxiety" class="font-semibold text-blue-600"></span>
            <span class="text-gray-500">| Stress:</span>
            <span id="current-stress" class="font-semibold text-orange-600"></span>
          </div>

          <!-- Chat Messages -->
          <div class="flex-1 p-6 overflow-y-auto" id="chat-messages" style="max-height: 70vh; min-height: 300px;">
    <div class="space-y-4">
      <div class="flex items-start">
        <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center mr-3 mt-1">
          <i class="bi bi-robot text-white text-sm"></i>
        </div>
        <div class="flex-1">
          <div class="bg-gray-100 rounded-lg p-4 max-w-md">
            <p class="text-gray-800">
              Hello! I'm here to support you. 
            </p>
          </div>
          <span class="text-xs text-gray-500 mt-1 block">Just now</span>
        </div>
      </div>
    </div>
</div>
<script>
  // Ensure chat-messages is scrolled to top on load
  document.addEventListener("DOMContentLoaded", function () {
    const chatMessages = document.getElementById("chat-messages");
    if (chatMessages) {
      chatMessages.scrollTop = 0;
    }
  });
</script>

          <!-- Chat Input -->
          <div class="p-6 border-t border-gray-200">
            <form id="chat-form" class="flex space-x-4">
              <input
                type="text"
                id="chat-input"
                placeholder="Type your message here..."
                class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                autocomplete="off"
              />
              <button
                type="submit"
                class="bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition duration-300"
              >
                <i class="bi bi-send"></i>
              </button>
            </form>
            <div class="mt-3 flex flex-wrap gap-2" id="quick-responses">
              <button
                class="quick-response-btn bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm hover:bg-gray-200 transition duration-300"
                data-message="I'm feeling anxious"
              >
                I'm feeling anxious
              </button>
              <button
                class="quick-response-btn bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm hover:bg-gray-200 transition duration-300"
                data-message="I'm feeling sad"
              >
                I'm feeling sad
              </button>
              <button
                class="quick-response-btn bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm hover:bg-gray-200 transition duration-300"
                data-message="I'm stressed"
              >
                I'm stressed
              </button>
              <button
                class="quick-response-btn bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm hover:bg-gray-200 transition duration-300"
                data-message="I need help"
              >
                I need help
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Top Row: Crisis Support, Guidelines, Topics, Quick Actions -->
      <div class="flex flex-col lg:flex-row gap-4 mb-10">
        <!-- Chat Guidelines -->
        <div class="flex-1 min-w-[220px] bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center">
          <h3 class="text-lg font-semibold text-gray-800 mb-2 flex items-center"><i class="bi bi-chat-dots text-purple-600 mr-2"></i>Chat Guidelines</h3>
          <ul class="space-y-2 text-sm text-gray-600 w-full">
            <li class="flex items-start"><i class="bi bi-check-circle text-green-500 mr-2 mt-1"></i><span>Be honest about your feelings</span></li>
            <li class="flex items-start"><i class="bi bi-check-circle text-green-500 mr-2 mt-1"></i><span>Take your time to express yourself</span></li>
            <li class="flex items-start"><i class="bi bi-check-circle text-green-500 mr-2 mt-1"></i><span>Ask for specific coping strategies</span></li>
            <li class="flex items-start"><i class="bi bi-check-circle text-green-500 mr-2 mt-1"></i><span>Remember this is a safe space</span></li>
          </ul>
        </div>
        <!-- Helpful Topics -->
        <div class="flex-1 min-w-[220px] bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center">
          <h3 class="text-lg font-semibold text-gray-800 mb-2 flex items-center"><i class="bi bi-lightbulb text-yellow-600 mr-2"></i>What I Can Help With</h3>
          <div class="space-y-2 text-sm w-full">
            <div class="p-2 bg-blue-50 rounded cursor-pointer hover:bg-blue-100 transition duration-300 topic-btn" data-topic="anxiety"><i class="bi bi-heart-pulse text-blue-600 mr-2"></i><span class="text-blue-800">Anxiety Management</span></div>
            <div class="p-2 bg-green-50 rounded cursor-pointer hover:bg-green-100 transition duration-300 topic-btn" data-topic="stress"><i class="bi bi-speedometer text-green-600 mr-2"></i><span class="text-green-800">Stress Relief</span></div>
            <div class="p-2 bg-purple-50 rounded cursor-pointer hover:bg-purple-100 transition duration-300 topic-btn" data-topic="depression"><i class="bi bi-cloud-rain text-purple-600 mr-2"></i><span class="text-purple-800">Depression Support</span></div>
            <div class="p-2 bg-orange-50 rounded cursor-pointer hover:bg-orange-100 transition duration-300 topic-btn" data-topic="sleep"><i class="bi bi-moon text-orange-600 mr-2"></i><span class="text-orange-800">Sleep Issues</span></div>
            <div class="p-2 bg-pink-50 rounded cursor-pointer hover:bg-pink-100 transition duration-300 topic-btn" data-topic="relationships"><i class="bi bi-people text-pink-600 mr-2"></i><span class="text-pink-800">Relationships</span></div>
          </div>
        </div>
        <!-- Quick Actions -->
        <div class="flex-1 min-w-[220px] bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center">
          <h3 class="text-lg font-semibold text-gray-800 mb-2 flex items-center"><i class="bi bi-lightning text-blue-600 mr-2"></i>Quick Actions</h3>
          <div class="space-y-3 w-full">
            <a href="{{ url_for('breathing') }}" class="block w-full text-center bg-blue-100 text-blue-800 py-2 px-4 rounded-lg hover:bg-blue-200 transition duration-300"><i class="bi bi-wind mr-2"></i>Breathing Exercise</a>
            <a href="{{ url_for('journal') }}" class="block w-full text-center bg-green-100 text-green-800 py-2 px-4 rounded-lg hover:bg-green-200 transition duration-300"><i class="bi bi-journal-text mr-2"></i>Write in Journal</a>
            <a href="{{ url_for('games') }}" class="block w-full text-center bg-purple-100 text-purple-800 py-2 px-4 rounded-lg hover:bg-purple-200 transition duration-300"><i class="bi bi-puzzle mr-2"></i>Play Mental Games</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Crisis Support (Philippines) - Before Footer -->
<div class="mt-10">
  <div class="bg-red-50 border border-red-200 rounded-xl p-6">
    <h3 class="text-lg font-semibold text-red-800 mb-4 flex items-center"><i class="bi bi-exclamation-triangle text-red-600 mr-2"></i>Crisis Support</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm w-full">
      <div class="bg-white rounded shadow p-4">
        <p class="font-semibold text-red-800">National Center for Mental Health (NCMH)</p>
        <span class="block text-red-600">Landline: <a href="tel:1553" class="underline">1553</a> (Nationwide, Toll-Free)</span>
        <span class="block text-red-600">Globe/TM: <a href="tel:09663514518" class="underline">0966-351-4518</a>, <a href="tel:09178998727" class="underline">0917-899-8727</a></span>
        <span class="block text-red-600">Smart/Sun/TNT: <a href="tel:09086392672" class="underline">0908-639-2672</a></span>
        <span class="block text-gray-600">24/7. Free, confidential, Luzon-wide landlines are toll-free.</span>
      </div>
      <div class="bg-white rounded shadow p-4">
        <p class="font-semibold text-red-800">In Touch Community Services</p>
        <span class="block text-red-600">Landline: <a href="tel:0288937603" class="underline">(02) 8893-7603</a></span>
        <span class="block text-red-600">Globe: <a href="tel:09178001123" class="underline">0917-800-1123</a></span>
        <span class="block text-red-600">Sun: <a href="tel:09228938944" class="underline">0922-893-8944</a></span>
        <span class="block text-gray-600">24/7, free, compassionate and confidential support.</span>
      </div>
      <div class="bg-white rounded shadow p-4">
        <p class="font-semibold text-red-800">NGF HOPELINE PH</p>
        <span class="block text-red-600">Globe/TM: <a href="tel:2919" class="underline">2919</a> (toll-free)</span>
        <span class="block text-red-600">Globe: <a href="tel:09175584673" class="underline">0917-558-HOPE (4673)</a></span>
        <span class="block text-red-600">Smart: <a href="tel:09188734673" class="underline">0918-873-HOPE (4673)</a></span>
        <span class="block text-red-600">Landline: <a href="tel:0288044673" class="underline">(02) 8804-HOPE (4673)</a></span>
        <span class="block text-gray-600">24/7 Suicide Prevention and Emotional Crisis Line.</span>
      </div>
      <div class="bg-white rounded shadow p-4">
        <p class="font-semibold text-red-800">Tawag Paglaum – Centro Bisaya</p>
        <span class="block text-red-600">Smart/Sun: <a href="tel:09399375433" class="underline">0939-9375433</a>, <a href="tel:09399365433" class="underline">0939-9365433</a></span>
        <span class="block text-red-600">Globe/TM: <a href="tel:09276541629" class="underline">0927-6541629</a></span>
        <span class="block text-gray-600">24/7 for emotional and suicidal crisis.</span>
      </div>
      <div class="bg-white rounded shadow p-4">
        <p class="font-semibold text-red-800">Philippine Mental Health Association (PMHA)</p>
        <span class="block text-red-600">Landline: <a href="tel:0289214958" class="underline">(02) 8921-4958</a>, <a href="tel:0289214959" class="underline">(02) 8921-4959</a> <span class="text-gray-600">(7am-4pm, Mon-Fri)</span></span>
        <span class="block text-red-600">Text: <a href="sms:09175652036" class="underline">0917-565-2036</a></span>
        <span class="block text-red-600">Email: <a href="mailto:pmhacds@gmail.com" class="underline">pmhacds@gmail.com</a></span>
        <span class="block text-gray-600">Chat: 8am-5pm, Mon-Sat.</span>
      </div>
      <div class="bg-white rounded shadow p-4">
        <p class="font-semibold text-red-800">Manila Lifeline Centre (MLC)</p>
        <span class="block text-red-600">Landline: <a href="tel:028969191" class="underline">(02) 896-9191</a></span>
        <span class="block text-red-600">Globe: <a href="tel:09178549191" class="underline">0917-854-9191</a></span>
        <span class="block text-gray-600">Focuses on suicide prevention, awareness, and support.</span>
      </div>
      <div class="bg-white rounded shadow p-4">
        <p class="font-semibold text-red-800">General Emergency Hotline</p>
        <span class="block text-red-600">Police, Fire, Medical: <a href="tel:911" class="underline">911</a></span>
        <span class="block text-gray-600">For immediate and severe emergencies.</span>
      </div>
    </div>
  </div>
</div>

{% endblock %} {% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const chatForm = document.getElementById("chat-form");
    const chatInput = document.getElementById("chat-input");
    const chatMessages = document.getElementById("chat-messages");

    // Fetch and display current mood (can be called on load or after journal save)
    function updateCurrentMoodBanner() {
      fetch("/get_journal_entries")
        .then((response) => response.json())
        .then((entries) => {
          if (entries.length > 0) {
            const latest = entries[0];
            const mood = latest.mood || "-";
            const anxiety = latest.anxiety || latest.anxiety_level || "-";
            const stress = latest.stress || latest.stress_level || "-";
            const moodEmojiMap = {
              happy: "😊",
              sad: "😢",
              anxious: "😰",
              calm: "😌",
              angry: "😠",
              neutral: "😐",
              "very-sad": "😭",
              excited: "😃",
              tired: "😴",
            };
            const moodEmoji = moodEmojiMap[mood] || "😐";
            document.getElementById("current-mood-emoji").textContent = moodEmoji;
            document.getElementById("current-mood-text").textContent = mood;
            document.getElementById("current-anxiety").textContent = anxiety;
            document.getElementById("current-stress").textContent = stress;
            document.getElementById("current-mood-banner").style.display = "flex";
          }
        });
    }
    // Call on load
    updateCurrentMoodBanner();

    // Handle form submission
    chatForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const message = chatInput.value.trim();
      if (message) {
        sendMessage(message);
        chatInput.value = "";
      }
    });

    // Handle quick response buttons
    document.querySelectorAll(".quick-response-btn").forEach((btn) => {
      btn.addEventListener("click", function () {
        const message = this.dataset.message;
        sendMessage(message);
      });
    });

    // Handle topic buttons
    document.querySelectorAll(".topic-btn").forEach((btn) => {
      btn.addEventListener("click", function () {
        const topic = this.dataset.topic;
        const messages = {
          anxiety: "I would like to learn about managing anxiety",
          stress: "I need help with stress management",
          depression: "I am dealing with feelings of depression",
          sleep: "I am having trouble sleeping",
          relationships: "I need advice about relationships",
        };
        sendMessage(messages[topic]);
      });
    });

    // Auto-focus on input
    chatInput.focus();
  });

  function sendMessage(message) {
    // Add user message to chat
    addMessageToChat(message, "user");

    // Show typing indicator
    showTypingIndicator();

    // Send message to backend
    fetch("/chat", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ message: message }),
    })
      .then((response) => response.json())
      .then((data) => {
        hideTypingIndicator();
        addMessageToChat(data.response, "ai");
      })
      .catch((error) => {
        hideTypingIndicator();
        console.error("Error:", error);
        addMessageToChat(
          "I apologize, but I seem to be having trouble connecting right now. Please try again in a moment.",
          "ai"
        );
      });
  }

  function addMessageToChat(message, sender) {
    const chatMessages = document.getElementById("chat-messages");
    const messageDiv = document.createElement("div");
    const time = new Date().toLocaleTimeString([], {
      hour: "2-digit",
      minute: "2-digit",
    });

    if (sender === "user") {
      messageDiv.innerHTML = `
            <div class="flex items-start justify-end">
                <div class="flex-1 max-w-md">
                    <div class="bg-purple-600 text-white rounded-lg p-4 ml-auto">
                        <p>${message}</p>
                    </div>
                    <span class="text-xs text-gray-500 mt-1 block text-right">${time}</span>
                </div>
                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center ml-3 mt-1">
                    <i class="bi bi-person text-white text-sm"></i>
                </div>
            </div>
        `;
    } else {
      messageDiv.innerHTML = `
            <div class="flex items-start">
                <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center mr-3 mt-1">
                    <i class="bi bi-robot text-white text-sm"></i>
                </div>
                <div class="flex-1">
                    <div class="bg-gray-100 rounded-lg p-4 max-w-md">
                        <p class="text-gray-800">${message}</p>
                    </div>
                    <span class="text-xs text-gray-500 mt-1 block">${time}</span>
                </div>
            </div>
        `;
    }

    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function showTypingIndicator() {
    const chatMessages = document.getElementById("chat-messages");
    const typingDiv = document.createElement("div");
    typingDiv.id = "typing-indicator";
    typingDiv.innerHTML = `
        <div class="flex items-start">
            <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center mr-3 mt-1">
                <i class="bi bi-robot text-white text-sm"></i>
            </div>
            <div class="flex-1">
                <div class="bg-gray-100 rounded-lg p-4 max-w-md">
                    <div class="flex space-x-1">
                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    </div>
                </div>
            </div>
        </div>
    `;

    chatMessages.appendChild(typingDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function hideTypingIndicator() {
    const typingIndicator = document.getElementById("typing-indicator");
    if (typingIndicator) {
      typingIndicator.remove();
    }
  }
// Listen for a custom event after journal save to refresh mood
window.addEventListener('journalSaved', function() {
  if (typeof updateCurrentMoodBanner === 'function') {
    updateCurrentMoodBanner();
  }
});

</script>
{% endblock %}
